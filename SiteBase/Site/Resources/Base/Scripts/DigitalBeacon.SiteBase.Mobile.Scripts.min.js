if(typeof DigitalBeacon=="undefined"){DigitalBeacon={}}if(!DigitalBeacon.SiteBase){DigitalBeacon.SiteBase={}}if(!DigitalBeacon.SiteBase.Mobile){DigitalBeacon.SiteBase.Mobile={}}if(!DigitalBeacon.SiteBase.Mobile.Account){DigitalBeacon.SiteBase.Mobile.Account={}}DigitalBeacon.SiteBase.Mobile.Account.AccountModule=(function(){function a(){}return a})();DigitalBeacon.SiteBase.Mobile.Account.AccountService=(function(){function a(){}return a})();DigitalBeacon.SiteBase.Mobile.BaseController=(function(){function a(){}var b=a.prototype;b._scope=null;b._routerState=null;b._location=null;b.data=null;b.get_ScopeData=function(){return this.data};b.get_Scope=function(){return(this._scope)||this};b.set_Scope=function(c){this._scope=c};b.get_RouterState=function(){return this._routerState};b.set_RouterState=function(c){this._routerState=c};b.get_RouterParams=function(){return this._routerState?this._routerState.params:{}};b.get_Location=function(){return this._location};b.set_Location=function(c){this._location=c};b.get_DefaultHandler=function(){return Blade.del(this,function(c){DigitalBeacon.SiteBase.ControllerHelper.handleResponse(c,this.get_Scope())})};b.get_ResponseHandler=function(){return Blade.del(this,function(c){this.handleResponse(c)})};b.get_HasFileInput=function(){return this.get_ScopeData().fileInput};b.get_Files=function(){return this.get_ScopeData().fileInput.files};b.init=function(){this.data={model:{}}};b.submitForm=function(d,c){this.get_ScopeData()[d].submitted=true;if(!c){scrollTo(0,0);return}this.submit(d)};b.resetForm=function(c,d){d=(d!==undefined)?d:"model";(this.get_Scope()[c]).$setPristine();if(d){this.get_ScopeData()[d].submitted=false}};b.submit=function(c){};b.setAlerts=function(c){this.get_ScopeData().alerts=c;if(c&&c.length>0){scrollTo(0,0)}};b.hasAlert=function(d){if(!this.get_ScopeData().alerts||this.get_ScopeData().alerts.length===0){return false}for(var c=0;c<this.get_ScopeData().alerts.length;c++){if(this.get_ScopeData().alerts[c].key===d){return true}}return false};b.clearAlerts=function(d){d=(d!==undefined)?d:null;if(this.get_ScopeData().alerts&&this.get_ScopeData().alerts.length>0){if(d){for(var c=this.get_ScopeData().alerts.length-1;c>=0;c--){if(this.get_ScopeData().alerts[c].key===d){this.closeAlert(c)}}}else{this.get_ScopeData().alerts.length=0}}if(!this.get_ScopeData().alerts){this.get_ScopeData().alerts=new Array(0)}};b.closeAlert=function(c){this.get_ScopeData().alerts.splice(c,1)};b.setAlert=function(d,c){c=(c!==undefined)?c:true;this.clearAlerts();this.get_ScopeData().alerts.push({msg:d,type:c?"danger":"success"})};b.toggle=function(d,c){d.preventDefault();d.stopPropagation();this.get_ScopeData()[c]=this.get_ScopeData()[c]?false:true};b.fileChanged=function(c){if(!c){return}var d=c.files;if(c.files&&c.files.length){this.get_ScopeData().fileInput=c}else{this.get_ScopeData().fileInput=null}(this.get_Scope()[c.form.name]).$setDirty();this.get_Scope().$apply()};b.handleResponse=function(c){DigitalBeacon.SiteBase.ControllerHelper.handleResponse(c,this.get_Scope())};b.getStateData=function(d){var c=this.get_RouterState().get(d);if(c){if(!DigitalBeacon.Utils.isDefined(c.data)){c.data={}}return c.data}return null};b.go=function(d,c){c=(c!==undefined)?c:null;this.get_RouterState().go(d,c)};b.createHandler=function(c){return Blade.del(this,function(d){if(d.Success){c(d)}else{DigitalBeacon.SiteBase.ControllerHelper.handleResponse(d,this.get_Scope())}})};return a})();DigitalBeacon.SiteBase.Mobile.BaseController.initScope=function(b,a){($.extend(b,a)).init()};DigitalBeacon.SiteBase.Mobile.BaseEntityService=(function(){function a(){}var b=a.prototype;b.$Resource=null;b.get_Resource=function(){return this.$Resource};b.set_Resource=function(c){this.$Resource=c};b.get=function(c,d){d=(d!==undefined)?d:null;return this.get_Resource().get({id:c},d)};b.search=function(c,d){this.get_Resource().search(c,d)};b.save=function(c,d,e){e=(e!==undefined)?e:null;if(c){this.get_Resource().update({id:c},d,e)}else{this.get_Resource().save(d,e)}};b.remove=function(c,d){d=(d!==undefined)?d:null;this.get_Resource().remove({id:c},d)};b.sendFormData=function(f,c,g,h,d,i){i=(i!==undefined)?i:null;var e={};e["Content-Type"]=undefined;f({method:g?"PUT":"POST",url:$.digitalbeacon.resolveUrl("~/"+c+(g?("/"+g):"")+"/json"),headers:e,data:DigitalBeacon.SiteBase.Mobile.BaseEntityService.constructFormData(h,d),transformRequest:Blade.del(this,function(j){return j})}).success(i)};Blade.impl(a,"DigitalBeacon.SiteBase.Mobile.IEntityService");return a})();DigitalBeacon.SiteBase.Mobile.BaseEntityService.constructFormData=function(f,c){var b=new FormData();var e=null;var a=Object.keys(f).GetEnumerator();while(a.MoveNext()){e=a.get_Current();if(e.slice(0,1)==="$"){continue}if(f[e]||$.digitalbeacon.isOfType(f[e],"boolean")){if(angular.isDate(f[e])){b.append(e,JSON.stringify(f[e]).replace('"',"").replace('"',""))}else{b.append(e,f[e])}}}if(c){for(var d=0;d<c.length;d++){b.append("file"+d,c[d])}}return b};if(!DigitalBeacon.SiteBase.Mobile.Contacts){DigitalBeacon.SiteBase.Mobile.Contacts={}}DigitalBeacon.SiteBase.Mobile.Contacts.ContactsModule=(function(){function a(){}return a})();if(!DigitalBeacon.SiteBase.Mobile.Identity){DigitalBeacon.SiteBase.Mobile.Identity={}}DigitalBeacon.SiteBase.Mobile.Identity.IdentityModule=(function(){function a(){}return a})();DigitalBeacon.SiteBase.Mobile.Identity.IdentityService=(function(){function a(){}return a})();DigitalBeacon.SiteBase.Mobile.ListIem=(function(){function a(){}var b=a.prototype;b.Item=null;return a})();DigitalBeacon.SiteBase.Mobile.SiteBaseModule=(function(){function a(){}return a})();DigitalBeacon.SiteBase.Mobile.Account.ChangePasswordController=(function(){Blade.derive(b,DigitalBeacon.SiteBase.Mobile.BaseController);var a=DigitalBeacon.SiteBase.Mobile.BaseController.prototype;function b(e,d){a.constructor.call(this);this.set_Scope(e);this._accountService=d}var c=b.prototype;c._accountService=null;c.submit=function(d){if(this.get_ScopeData().model.NewPasswordConfirm!==this.get_ScopeData().model.NewPassword){this.setAlert($.sb.localization.passwordConfirmNotMatched);return}if(this.get_ScopeData().model.NewPassword===this.get_ScopeData().model.Username){this.setAlert($.sb.localization.passwordInvalid);return}this._accountService.changePassword(this.get_ScopeData().model,this.get_DefaultHandler())};return b})();DigitalBeacon.SiteBase.Mobile.Account.ChangeSecurityQuestionController=(function(){Blade.derive(b,DigitalBeacon.SiteBase.Mobile.BaseController);var a=DigitalBeacon.SiteBase.Mobile.BaseController.prototype;function b(e,d){a.constructor.call(this);this.set_Scope(e);this._accountService=d}var c=b.prototype;c._accountService=null;c.submit=function(d){this._accountService.changeSecurityQuestion(this.get_ScopeData().model,this.get_DefaultHandler())};return b})();DigitalBeacon.SiteBase.Mobile.Account.UpdateProfileController=(function(){Blade.derive(c,DigitalBeacon.SiteBase.Mobile.BaseController);var a=DigitalBeacon.SiteBase.Mobile.BaseController.prototype;function c(e,d){a.constructor.call(this);this.set_Scope(e);this._accountService=d}var b=c.prototype;b._accountService=null;b.init=function(){a.init.call(this);this._accountService.getProfile(null,this.createHandler(Blade.del(this,function(f){var e=this.get_ScopeData().model.Language;f.Data.Language=f.Data.Language||e;var d=this.get_ScopeData().model.Country;f.Data.Country=f.Data.Country||d;f.Data.State=f.Data.State||"";this.get_ScopeData().model=f.Data})))};b.submit=function(d){this._accountService.updateProfile(this.get_ScopeData().model,this.get_DefaultHandler())};return c})();DigitalBeacon.SiteBase.Mobile.BaseDetailsController=(function(){Blade.derive(b,DigitalBeacon.SiteBase.Mobile.BaseController);var a=DigitalBeacon.SiteBase.Mobile.BaseController.prototype;function b(e,f,d){a.constructor.call(this);this.set_Scope(e);this.set_RouterState(f);this.set_Location(d)}var c=b.prototype;c.get_ReturnToList=function(){return this.createHandler(Blade.del(this,function(d){this.hide(d)}))};c.get_SaveHandler=function(){return this.createHandler(Blade.del(this,function(d){this.onSaveSuccess(d)}))};c.init=function(){a.init.call(this);if(this.get_RouterParams().id){this.load(this.get_RouterParams().id)}if(this.get_RouterState().current.data&&this.get_RouterState().current.data.alerts){this.get_ScopeData().alerts=this.get_RouterState().current.data.alerts;this.get_RouterState().current.data.alerts=null}this.show()};c.getDisplayObject=function(h){var f={};var e=null;var d=Object.keys(h).GetEnumerator();while(d.MoveNext()){e=d.get_Current();var g=h[e];if(!g||(Blade.is(g,Array)&&g.length===0)){continue}f[e]=h[e]}return f};c.hide=function(d){d=(d!==undefined)?d:null;this.get_Scope().$emit("hideDetails",d)};c.show=function(){this.get_Scope().$emit("showDetails")};c.detailsChanged=function(){this.get_Scope().$emit("detailsChanged")};c.submit=function(d){this.save()};c.load=function(d){};c.save=function(){};c.remove=function(){};c.cancel=function(){if(this.get_RouterState().is("list.edit")){this.get_RouterState().go("list.display",{id:this.get_ScopeData().model.Id})}else{this.hide()}};c.previous=function(){this.get_Scope().$emit("showPrevious",this.get_ScopeData().model.Id)};c.next=function(){this.get_Scope().$emit("showNext",this.get_ScopeData().model.Id)};c.handleResponse=function(d){DigitalBeacon.SiteBase.ControllerHelper.handleResponse(d,this.get_Scope());if(d.Success){this.load(this.get_ScopeData().model.Id)}};c.onSaveSuccess=function(d){this.detailsChanged();this.get_ScopeData().fileInput=null;this.getStateData("list.display").alerts=DigitalBeacon.SiteBase.ControllerHelper.getAlerts(d);this.get_RouterState().go("list.display",{id:this.get_ScopeData().model.Id||(d).Data})};return b})();DigitalBeacon.SiteBase.Mobile.BaseListController=(function(){Blade.derive(b,DigitalBeacon.SiteBase.Mobile.BaseController);var a=DigitalBeacon.SiteBase.Mobile.BaseController.prototype;function b(){a.constructor.call(this)}var c=b.prototype;c.get_ScopeData=function(){return this.data};c.init=function(){a.init.call(this);$.extend(this.data,{page:1,pageSize:20,pageCount:-1,sortDirection:"",isCollapsedAdvancedSearch:true,footerHeight:140,listVisible:true});this.get_ScopeData().listVisible=this.isListState();this.get_Scope().$on("hideDetails",Blade.del(this,function(e,d){this.showList(d)}));this.get_Scope().$on("showDetails",Blade.del(this,function(){this.hideList()}));this.get_Scope().$on("showPrevious",Blade.del(this,function(e,d){this.showPrevious(d)}));this.get_Scope().$on("showNext",Blade.del(this,function(e,d){this.showNext(d)}));this.get_Scope().$on("detailsChanged",Blade.del(this,function(){this.getStateData("list").refresh=true}));this.get_Scope().$on("alerts",Blade.del(this,function(e,d){this.get_ScopeData().alerts=d}));this.get_Scope().$watch(Blade.del(this,function(){return this.get_Location().url()}),Blade.del(this,function(d){if(!this.get_ScopeData().listVisible&&d&&this.isListState()){this.showList()}if(!this.get_RouterState().is("list.display")){this.get_ScopeData().transitionPrevious=false;this.get_ScopeData().transitionNext=false}scrollTo(0,0)}))};c.search=function(d){d=(d!==undefined)?d:false};c.queueSearch=function(){setTimeout(Blade.del(this,function(){this.search();this.get_Scope().$apply()}),100)};c.loadMore=function(){if(this.get_ScopeData().page<this.get_ScopeData().pageCount){this.get_ScopeData().page++;this.search(true)}};c.addNew=function(){this.clearAlerts();this.get_RouterState().go("list.new");this.get_ScopeData().model={}};c.showDetails=function(e){this.clearAlerts();this.get_RouterState().go("list.display",{id:e});for(var d=0;d<this.get_ScopeData().items.length;d++){if(this.get_ScopeData().items[d].Id===e){if(d>=this.get_ScopeData().items.length-2){this.loadMore()}break}}};c.showPrevious=function(d){if(!this.get_ScopeData().items||this.get_ScopeData().items.length<2){return}this.get_ScopeData().transitionPrevious=true;this.get_ScopeData().transitionNext=false;for(var e=1;e<this.get_ScopeData().items.length;e++){if(this.get_ScopeData().items[e].Id===d){this.showDetails(this.get_ScopeData().items[e-1].Id);break}}};c.showNext=function(d){if(!this.get_ScopeData().items||this.get_ScopeData().items.length<2){return}this.get_ScopeData().transitionPrevious=false;this.get_ScopeData().transitionNext=true;for(var e=0;e<this.get_ScopeData().items.length-1;e++){if(this.get_ScopeData().items[e].Id===d){this.showDetails(this.get_ScopeData().items[e+1].Id);break}}};c.hideList=function(){this.get_ScopeData().listVisible=false;this.disableLoadMoreOnScroll();this.get_ScopeData().lastScrollTop=scrollY};c.showList=function(d){d=(d!==undefined)?d:null;this.get_ScopeData().listVisible=true;this.get_RouterState().go("list");if(this.get_ScopeData().pageCount<0||this.getStateData("list").refresh){this.getStateData("list").refresh=false;this.search()}this.enableLoadMoreOnScroll();if(d){DigitalBeacon.SiteBase.ControllerHelper.handleResponse(d,this.get_Scope())}if(this.get_ScopeData().lastScrollTop){setTimeout(Blade.del(this,function(){scroll(0,this.get_ScopeData().lastScrollTop);this.get_ScopeData().lastScrollTop=0}),0)}};c.isListState=function(){return this.get_RouterState().current.name==="list"};c.clearSearch=function(d){d=(d!==undefined)?d:true;this.get_ScopeData().searchText="";if(d){this.get_ScopeData().sortText="";this.get_ScopeData().sortDirection=""}this.search();this.get_ScopeData().isFiltered=false;this.get_ScopeData().page=1};c.getSortValue=function(){return this.get_ScopeData().sortText+this.get_ScopeData().sortDirection};c.enableLoadMoreOnScroll=function(){if(this.get_ScopeData().pageCount<=1||!this.get_ScopeData().listVisible){return}scrollTo(0,0);$(self).on("scroll.sbClientListPanel",null,null,(Blade.del(this,function(g){var h=$(self);var f=$(document);if(f.height()>h.height()&&((h.scrollTop()>=f.height()-h.height()-this.get_ScopeData().footerHeight)||(h.scrollTop()>=f.height()/2))){this.loadMore()}})))};c.disableLoadMoreOnScroll=function(){$(self).off("scroll.sbClientListPanel")};return b})();DigitalBeacon.SiteBase.Mobile.BaseListController.SortDirectionAscending="";DigitalBeacon.SiteBase.Mobile.BaseListController.SortDirectionDescending="-DESC";DigitalBeacon.SiteBase.Mobile.Contacts.ContactDetailsController=(function(){Blade.derive(b,DigitalBeacon.SiteBase.Mobile.BaseDetailsController);var a=DigitalBeacon.SiteBase.Mobile.BaseDetailsController.prototype;function b(f,g,e,d){a.constructor.call(this,f,g,e);this._contactService=d}var c=b.prototype;c._contactService=null;c.get_ScopeData=function(){return this.data};c.init=function(){a.init.call(this);$.extend(this.data,{comment:{},isLoading:true,isCollapsedCommentEditor:true})};c.handleResponse=function(d){this.get_ScopeData().isOpenPhotoActions=false;if(d.Success){this.detailsChanged()}a.handleResponse.call(this,d)};c.load=function(d){this.get_ScopeData().model=this._contactService.get(d,Blade.del(this,function(e){this.get_ScopeData().isLoading=false;if(e.Success&&e.Id){this.get_ScopeData().photoUrl=$.digitalbeacon.resolveUrl("~/contacts/{0}/photo?x={1}".formatWith(e.Id,e.PhotoId))}else{DigitalBeacon.SiteBase.ControllerHelper.handleResponse(e,this.get_Scope())}}));this.getComments(d)};c.submit=function(d){if(d==="comment"){this.saveComment()}else{this.save()}};c.save=function(){if(this.get_HasFileInput()){this._contactService.saveWithFileData(this.get_ScopeData().model.Id,this.get_ScopeData().model,this.get_Files(),this.get_SaveHandler())}else{this._contactService.save(this.get_ScopeData().model.Id,this.get_ScopeData().model,this.get_SaveHandler())}};c.remove=function(){if(this.get_ScopeData().model.Id&&confirm($.sb.localization.confirmText)){this.detailsChanged();this._contactService.remove(this.get_ScopeData().model.Id,this.get_ReturnToList())}};c.deletePhoto=function(){if(this.get_ScopeData().model.Id&&confirm($.sb.localization.confirmText)){this._contactService.deletePhoto(this.get_ScopeData().model.Id,this.get_ResponseHandler())}};c.rotatePhotoCounterclockwise=function(){if(this.get_ScopeData().model.Id&&confirm($.sb.localization.confirmText)){this._contactService.rotatePhotoCounterclockwise(this.get_ScopeData().model.Id,this.get_ResponseHandler())}};c.rotatePhotoClockwise=function(){if(this.get_ScopeData().model.Id&&confirm($.sb.localization.confirmText)){this._contactService.rotatePhotoClockwise(this.get_ScopeData().model.Id,this.get_ResponseHandler())}};c.getComments=function(d,e){e=(e!==undefined)?e:false;if(this.get_RouterState().is("list.display")){this._contactService.getComments(d,this.createHandler(Blade.del(this,function(f){this.get_ScopeData().comments=f.Data.Items;setTimeout(Blade.del(this,function(){this.get_ScopeData().isCollapsedCommentEditor=true;this.get_Scope().$apply()}),0)})))}if(e){this.detailsChanged()}};c.newComment=function(){this.get_ScopeData().comment={};this.resetForm("commentEditPanel","comment");this.get_ScopeData().isCollapsedCommentEditor=false};c.editComment=function(d){this.get_ScopeData().comment=this._contactService.getComment(d,Blade.del(this,function(e){this.resetForm("commentEditPanel","comment");this.get_ScopeData().isCollapsedCommentEditor=false}))};c.saveComment=function(){this.get_ScopeData().comment.ParentId=this.get_ScopeData().model.Id;this._contactService.saveComment(this.get_ScopeData().comment.Id,this.get_ScopeData().comment,this.createHandler(Blade.del(this,function(d){this.getComments(this.get_ScopeData().model.Id,true)})))};c.cancelComment=function(){this.get_ScopeData().isCollapsedCommentEditor=true};c.deleteComment=function(d){if(this.get_ScopeData().model.Id&&d&&confirm($.sb.localization.confirmText)){this.detailsChanged();this._contactService.deleteComment(d,this.createHandler(Blade.del(this,function(e){this.getComments(this.get_ScopeData().model.Id)})))}};return b})();DigitalBeacon.SiteBase.Mobile.Contacts.ContactListController=(function(){Blade.derive(b,DigitalBeacon.SiteBase.Mobile.BaseListController);var a=DigitalBeacon.SiteBase.Mobile.BaseListController.prototype;function b(f,g,e,d){a.constructor.call(this);this.set_Scope(f);this.set_RouterState(g);this.set_Location(e);this._contactService=d}var c=b.prototype;c._contactService=null;c.get_ScopeData=function(){return this.data};c.init=function(){a.init.call(this);this.get_ScopeData().sortText=DigitalBeacon.SiteBase.Mobile.Contacts.ContactListController.DefaultSortText;this.get_ScopeData().sortDirection=DigitalBeacon.SiteBase.Mobile.BaseListController.SortDirectionAscending;this.get_ScopeData().CommentTypeId="";this.get_ScopeData().Inactive="";this.search()};c.search=function(d){d=(d!==undefined)?d:false;if(!d){this.get_ScopeData().page=1}this.get_ScopeData().isFiltered=this.get_ScopeData().searchText&&this.get_ScopeData().searchText.hasText();this._contactService.search({PageSize:this.get_ScopeData().pageSize,Page:this.get_ScopeData().page,SearchText:this.get_ScopeData().searchText,SortValue:this.getSortValue(),CommentTypeId:this.get_ScopeData().CommentTypeId,Inactive:this.get_ScopeData().Inactive},(Blade.del(this,function(e){this.handleResponse(e,d)})))};c.clearSearch=function(d){d=(d!==undefined)?d:true;if(!this.get_ScopeData().isCollapsedAdvancedSearch){if(d){this.get_ScopeData().sortText=DigitalBeacon.SiteBase.Mobile.Contacts.ContactListController.DefaultSortText;this.get_ScopeData().sortDirection=DigitalBeacon.SiteBase.Mobile.BaseListController.SortDirectionAscending}this.get_ScopeData().CommentTypeId="";this.get_ScopeData().Inactive=""}a.clearSearch.call(this,false)};c.handleResponse=function(g,f){var e=null;var d=g.Data.GetEnumerator();while(d.MoveNext()){e=d.get_Current();if(e.PhotoId){e.photoUrl=$.digitalbeacon.resolveUrl("~/contacts/{0}/thumbnail?x={1}".formatWith(e.Id,e.PhotoId))}}if(f){var e=null;var d=g.Data.GetEnumerator();while(d.MoveNext()){e=d.get_Current();this.get_ScopeData().items.push(e)}}else{this.get_ScopeData().items=g.Data;this.get_ScopeData().pageCount=Math.ceil(g.Total/this.get_ScopeData().pageSize);this.enableLoadMoreOnScroll()}};return b})();DigitalBeacon.SiteBase.Mobile.Contacts.ContactListController.DefaultSortText="LastName";DigitalBeacon.SiteBase.Mobile.Contacts.ContactService=(function(){Blade.derive(b,DigitalBeacon.SiteBase.Mobile.BaseEntityService);var a=DigitalBeacon.SiteBase.Mobile.BaseEntityService.prototype;function b(d,e){a.constructor.call(this);this._http=d;this.set_Resource(e($.digitalbeacon.resolveUrl("~/contacts/:id/:action/json"),{id:"@id"},{update:{method:"PUT"},remove:{method:"DELETE"},search:{method:"POST",params:{action:"search"}},deletePhoto:{method:"POST",params:{action:"deletePhoto"}},rotatePhotoCounterclockwise:{method:"POST",params:{action:"rotatePhotoCounterclockwise"}},rotatePhotoClockwise:{method:"POST",params:{action:"rotatePhotoClockwise"}},comments:{method:"GET",params:{action:"comments"}}}));this._commentsResource=e($.digitalbeacon.resolveUrl("~/contactComments/:id/:action/json"),{id:"@id"},{update:{method:"PUT"},remove:{method:"DELETE"}})}var c=b.prototype;c._http=null;c._commentsResource=null;c.saveWithFileData=function(e,f,d,g){g=(g!==undefined)?g:null;this.sendFormData(this._http,"contacts",e,f,d,g)};c.deletePhoto=function(d,e){e=(e!==undefined)?e:null;this.get_Resource().deletePhoto({id:d},e)};c.rotatePhotoCounterclockwise=function(d,e){e=(e!==undefined)?e:null;this.get_Resource().rotatePhotoCounterclockwise({id:d},e)};c.rotatePhotoClockwise=function(d,e){e=(e!==undefined)?e:null;this.get_Resource().rotatePhotoClockwise({id:d},e)};c.getComments=function(d,e){e=(e!==undefined)?e:null;this.get_Resource().comments({id:d},e)};c.getComment=function(d,e){e=(e!==undefined)?e:null;return this._commentsResource.get({id:d},e)};c.deleteComment=function(d,e){e=(e!==undefined)?e:null;this._commentsResource.remove({id:d},e)};c.saveComment=function(e,d,f){f=(f!==undefined)?f:null;if(e){this._commentsResource.update({id:e},d,f)}else{this._commentsResource.save(d,f)}};Blade.impl(b,"DigitalBeacon.SiteBase.Mobile.IEntityService");return b})();DigitalBeacon.SiteBase.Mobile.Identity.ChangePasswordController=(function(){Blade.derive(b,DigitalBeacon.SiteBase.Mobile.BaseController);var a=DigitalBeacon.SiteBase.Mobile.BaseController.prototype;function b(e,d){a.constructor.call(this);this.set_Scope(e);this._identityService=d}var c=b.prototype;c._identityService=null;c.submit=function(d){if(this.get_ScopeData().model.PasswordConfirm!==this.get_ScopeData().model.Password){this.setAlert($.sb.localization.passwordConfirmNotMatched);return}if(this.get_ScopeData().model.Password===this.get_ScopeData().model.Username){this.setAlert($.sb.localization.passwordInvalid);return}this._identityService.changePassword(this.get_ScopeData().model,this.get_DefaultHandler())};return b})();DigitalBeacon.SiteBase.Mobile.Identity.RecoverUsernameController=(function(){Blade.derive(c,DigitalBeacon.SiteBase.Mobile.BaseController);var a=DigitalBeacon.SiteBase.Mobile.BaseController.prototype;function c(e,d){a.constructor.call(this);this.set_Scope(e);this._identityService=d}var b=c.prototype;b._identityService=null;b.submit=function(d){this._identityService.recoverUsername(this.get_ScopeData().model,this.get_DefaultHandler())};return c})();DigitalBeacon.SiteBase.Mobile.Identity.RegistrationController=(function(){Blade.derive(c,DigitalBeacon.SiteBase.Mobile.BaseController);var a=DigitalBeacon.SiteBase.Mobile.BaseController.prototype;function c(e,d){a.constructor.call(this);this.set_Scope(e);this._identityService=d}var b=c.prototype;b._identityService=null;b.submit=function(d){this._identityService.register(this.get_ScopeData().model,this.get_DefaultHandler())};return c})();DigitalBeacon.SiteBase.Mobile.Identity.ResetPasswordController=(function(){Blade.derive(c,DigitalBeacon.SiteBase.Mobile.BaseController);var a=DigitalBeacon.SiteBase.Mobile.BaseController.prototype;function c(e,d){a.constructor.call(this);this.set_Scope(e);this._identityService=d}var b=c.prototype;b._identityService=null;b.submit=function(d){if(this.get_ScopeData().model.PasswordConfirm!==this.get_ScopeData().model.Password){this.setAlert($.sb.localization.passwordConfirmNotMatched);return}if(this.get_ScopeData().model.Password===this.get_ScopeData().model.Username){this.setAlert($.sb.localization.passwordInvalid);return}this._identityService.resetPassword(this.get_ScopeData().model,this.createHandler(Blade.del(this,function(e){if(e.Data.Step>1){angular.extend(this.get_ScopeData().model,e.Data);this.resetForm("resetPasswordPanel");setTimeout(Blade.del(this,function(){$("#SecurityAnswer").focus()}),0)}})))};b.back=function(){this.get_ScopeData().model.Step=1;(this.get_Scope()["resetPasswordPanel"]).$setDirty()};return c})();DigitalBeacon.SiteBase.Mobile.Identity.SignInController=(function(){Blade.derive(c,DigitalBeacon.SiteBase.Mobile.BaseController);var a=DigitalBeacon.SiteBase.Mobile.BaseController.prototype;function c(e,d){a.constructor.call(this);this.set_Scope(e);this._identityService=d}var b=c.prototype;b._identityService=null;b.submit=function(d){this._identityService.signIn(this.get_ScopeData().model,this.get_DefaultHandler())};b.submitForm=function(e,d){if(!d){if(!this.get_ScopeData().model.Username){this.get_ScopeData().model.Username=$("#Username").val()}if(!this.get_ScopeData().model.Password){this.get_ScopeData().model.Password=$("#Password").val()}}this.submit(e)};return c})();angular.module("account",["sitebase","accountService"]).controller("updateProfileController",["$scope","accountService",(function(b,a){DigitalBeacon.SiteBase.Mobile.BaseController.initScope(b,new DigitalBeacon.SiteBase.Mobile.Account.UpdateProfileController(b,a))})]).controller("changePasswordController",["$scope","accountService",(function(b,a){DigitalBeacon.SiteBase.Mobile.BaseController.initScope(b,new DigitalBeacon.SiteBase.Mobile.Account.ChangePasswordController(b,a))})]).controller("changeSecurityQuestionController",["$scope","accountService",(function(b,a){DigitalBeacon.SiteBase.Mobile.BaseController.initScope(b,new DigitalBeacon.SiteBase.Mobile.Account.ChangeSecurityQuestionController(b,a))})]);angular.module("accountService",["ngResource"]).factory("accountService",["$resource",(function(a){return a($.digitalbeacon.resolveUrl("~/account/:operation/json"),{},{getProfile:{method:"GET",params:{operation:"updateProfile"}},updateProfile:{method:"POST",params:{operation:"updateProfile"}},changePassword:{method:"POST",params:{operation:"changePassword"}},changeSecurityQuestion:{method:"POST",params:{operation:"changeSecurityQuestion"}}})})]);angular.module("contacts",["sitebase","ui.router","contactService"]).config(["$stateProvider",(function(a){a.state("list",{url:$.digitalbeacon.resolveUrl("~/contacts"),templateUrl:$.digitalbeacon.resolveUrl("~/contacts/template"),controller:"contactListController"}).state("list.new",{url:"/new",templateUrl:$.digitalbeacon.resolveUrl("~/contacts/new/template"),controller:"contactDetailsController"}).state("list.display",{url:"/{id:[0-9]{1,9}}",templateUrl:$.digitalbeacon.resolveUrl("~/contacts/0/template"),controller:"contactDetailsController"}).state("list.edit",{url:"/{id:[0-9]{1,9}}/edit",templateUrl:$.digitalbeacon.resolveUrl("~/contacts/0/edit/template"),controller:"contactDetailsController"})})]).controller("contactListController",["$scope","$state","$location","contactService",(function(c,d,b,a){DigitalBeacon.SiteBase.Mobile.BaseController.initScope(c,new DigitalBeacon.SiteBase.Mobile.Contacts.ContactListController(c,d,b,a))})]).controller("contactDetailsController",["$scope","$state","$location","contactService",(function(c,d,b,a){DigitalBeacon.SiteBase.Mobile.BaseController.initScope(c,new DigitalBeacon.SiteBase.Mobile.Contacts.ContactDetailsController(c,d,b,a))})]).run(["$state",function(a){$.digitalbeacon.loadCssFile("~/resources/base/contacts/styles.css");a.transitionTo("list")}]);angular.module("identity",["sitebase","identityService"]).controller("signInController",["$scope","identityService",(function(b,a){DigitalBeacon.SiteBase.Mobile.BaseController.initScope(b,new DigitalBeacon.SiteBase.Mobile.Identity.SignInController(b,a))})]).controller("changePasswordController",["$scope","identityService",(function(b,a){DigitalBeacon.SiteBase.Mobile.BaseController.initScope(b,new DigitalBeacon.SiteBase.Mobile.Identity.ChangePasswordController(b,a))})]).controller("registrationController",["$scope","identityService",(function(b,a){DigitalBeacon.SiteBase.Mobile.BaseController.initScope(b,new DigitalBeacon.SiteBase.Mobile.Identity.RegistrationController(b,a))})]).controller("recoverUsernameController",["$scope","identityService",(function(b,a){DigitalBeacon.SiteBase.Mobile.BaseController.initScope(b,new DigitalBeacon.SiteBase.Mobile.Identity.RecoverUsernameController(b,a))})]).controller("resetPasswordController",["$scope","identityService",(function(b,a){DigitalBeacon.SiteBase.Mobile.BaseController.initScope(b,new DigitalBeacon.SiteBase.Mobile.Identity.ResetPasswordController(b,a))})]);angular.module("identityService",["ngResource"]).factory("identityService",["$resource",(function(a){return a($.digitalbeacon.resolveUrl("~/identity/:operation/json"),{},{signIn:{method:"POST",params:{operation:"signIn"}},changePassword:{method:"POST",params:{operation:"changePassword"}},register:{method:"POST",params:{operation:"register"}},recoverUsername:{method:"POST",params:{operation:"recoverUsername"}},resetPassword:{method:"POST",params:{operation:"resetPassword"}}})})]);angular.module("sitebase",["ngSanitize","ngAnimate","ngTouch","ui.bootstrap","ui.mask"]).config(["$httpProvider","$locationProvider","datepickerConfig",(function(b,c,a){c.html5Mode(true);b.defaults.transformRequest.push(function(d){$.sb.onAjaxStart();return d});b.defaults.transformResponse.push(function(d){$.sb.onAjaxEnd();return DigitalBeacon.Utils.convertDateStringsToDates(d)});a.showWeeks=false})]);angular.module("contactService",["ngResource"]).factory("contactService",["$http","$resource",(function(a,b){return new DigitalBeacon.SiteBase.Mobile.Contacts.ContactService(a,b)})]);