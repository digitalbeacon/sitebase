if(typeof DigitalBeacon=="undefined"){DigitalBeacon={}}if(!DigitalBeacon.SiteBase){DigitalBeacon.SiteBase={}}DigitalBeacon.SiteBase.ApiResponse=(function(){function a(){}var b=a.prototype;b.Success=null;b.Message=null;b.ErrorMessage=null;b.ValidationErrors=null;b.RedirectUrl=null;b.Data=null;return a})();DigitalBeacon.SiteBase.ControllerHelper=(function(){function a(){}return a})();DigitalBeacon.SiteBase.ControllerHelper.getAlerts=function(f){var c=new Array(0);if(f.Message){c.push({type:"success",msg:f.Message})}if(f.ErrorMessage){c.push({type:"danger",msg:f.ErrorMessage})}if(f.ValidationErrors){var d=null;var a=Object.keys(f.ValidationErrors).GetEnumerator();while(a.MoveNext()){d=a.get_Current();var e=null;var b=f.ValidationErrors[d].GetEnumerator();while(b.MoveNext()){e=b.get_Current();c.push({type:"danger",msg:e})}}}return c};DigitalBeacon.SiteBase.ControllerHelper.handleResponse=function(a,b){b=(b!==undefined)?b:null;if(a){if(a.RedirectUrl){location.assign(a.RedirectUrl)}else{if(b===null){alert(a.Message||a.ErrorMessage||DigitalBeacon.SiteBase.ControllerHelper.toString(a.ValidationErrors))}else{b.data.alerts=DigitalBeacon.SiteBase.ControllerHelper.getAlerts(a);scrollTo(0,0)}}}};DigitalBeacon.SiteBase.ControllerHelper.toString=function(d){var c="";var b=null;var a=Object.keys(d).GetEnumerator();while(a.MoveNext()){b=a.get_Current();c+=(d[b]).join("\n");c+="\n"}return c};DigitalBeacon.SiteBase.Editor=(function(){function a(c,d){if(d!==null){this._handleSiteRelativeUrls=d.handleSiteRelativeUrls||this._handleSiteRelativeUrls;this._defaultToTextBox=d.defaultToTextBox||this._defaultToTextBox}this._textArea=$(c);this._wrapperElement=this._textArea.parent().get(0);this._editorElement=$("table",this._wrapperElement);this._useEditorLink=$(".useEditor",this._wrapperElement);this._useTextBoxLink=$(".useTextBox",this._wrapperElement);this._useEditorLink.click(Blade.del(this,function(f){this.useEditor(f)}));this._useTextBoxLink.click(Blade.del(this,function(f){this.useTextBox(f)}));this._textArea.data("sbEditor",this);if(!this._defaultToTextBox){this.updateTelerikEditorValue()}}var b=a.prototype;b._wrapperElement=null;b._textArea=null;b._editorElement=null;b._editor=null;b._useEditorLink=null;b._useTextBoxLink=null;b._handleSiteRelativeUrls=true;b._defaultToTextBox=false;b.withTelerikEditor=function(c){if(this._editor){c();return}var d=((this._textArea.data("initAttempts")||0))+1;if(d>=10){$.digitalbeacon.log("Could not initialize Editor component for {0}.".formatWith(this._textArea.attr("id")));return}var e=this._editorElement.data("tEditor");if(!e){this._textArea.data("initAttempts",d);setTimeout((Blade.del(this,function(){this.withTelerikEditor(c)})),250);return}this._editor=e;c()};b.useEditor=function(c){this.updateTelerikEditorValue();this.toggleComponents(true);if(c!==null){c.preventDefault()}};b.useTextBox=function(c){this.updateTextAreaValue();this.toggleComponents(false);if(c!==null){c.preventDefault()}};b.toggleComponents=function(c){this._editorElement.toggle(c);this._useTextBoxLink.toggle(c);this._textArea.toggle(!c);this._useEditorLink.toggle(!c)};b.updateTelerikEditorValue=function(){this.withTelerikEditor(Blade.del(this,function(){var c=this._textArea.val();if(this._handleSiteRelativeUrls){c=c.expandSiteRelativeText()}this._editor.value(c)}))};b.updateTextAreaValue=function(){this.withTelerikEditor(Blade.del(this,function(){var c=this._editor.value();if(this._handleSiteRelativeUrls){c=c.toSiteRelativeText()}this._textArea.val(c)}))};b.prepareForValidation=function(){if(this._editorElement.is(":visible")){this.updateTextAreaValue()}};b.prepareForSubmission=function(){if(this._editorElement.is(":visible")){this.updateTextAreaValue()}this._textArea.val($.digitalbeacon.htmlEncode(this._textArea.val()))};b.value=function(c){c=(c!==undefined)?c:null;if(c){this._textArea.val(c);this.updateTelerikEditorValue()}else{this.prepareForValidation()}return this._textArea.val()};b.encodedValue=function(){return $.digitalbeacon.htmlEncode(this.value())};return a})();DigitalBeacon.SiteBase.SessionAuditor=(function(){function b(){}var a=b.prototype;a._authSessionUrl=null;a._extendSessionUrl=null;a._signOutUrl=null;a._intervalTimerId=null;a._notificationTimerId=null;a._signOutTimerId=null;a._pollingInterval=null;a._notificationTime=null;a._displayNotification=true;a._notificationHeading=null;a._notificationMessage=null;a._extendButtonText=null;a.get_pollingInterval=function(){return this._pollingInterval>0?this._pollingInterval:DigitalBeacon.SiteBase.SessionAuditor.DefaultPollingInterval};a.set_pollingInterval=function(c){this._pollingInterval=c};a.get_notificationTime=function(){return this._notificationTime>0?this._notificationTime:DigitalBeacon.SiteBase.SessionAuditor.DefaultNotificationTime};a.set_notificationTime=function(c){this._notificationTime=c};a.get_displayNotification=function(){return this._displayNotification};a.set_displayNotification=function(c){this._displayNotification=c};a.get_authSessionUrl=function(){return $.digitalbeacon.resolveUrl(this._authSessionUrl||DigitalBeacon.SiteBase.SessionAuditor.DefaultAuthSessionUrl)};a.set_authSessionUrl=function(c){this._authSessionUrl=c};a.get_extendSessionUrl=function(){return $.digitalbeacon.resolveUrl(this._extendSessionUrl||DigitalBeacon.SiteBase.SessionAuditor.DefaultExtendSessionUrl)};a.set_extendSessionUrl=function(c){this._extendSessionUrl=c};a.get_signOutUrl=function(){return $.digitalbeacon.resolveUrl(this._signOutUrl||DigitalBeacon.SiteBase.SessionAuditor.DefaultSignOutUrl)};a.set_signOutUrl=function(c){this._signOutUrl=c};a.get_notificationHeading=function(){return this._notificationHeading||DigitalBeacon.SiteBase.SessionAuditor.DefaultNotificationHeading};a.set_notificationHeading=function(c){this._notificationHeading=c};a.get_notificationMessage=function(){return this._notificationMessage||DigitalBeacon.SiteBase.SessionAuditor.DefaultNotificationMessage};a.set_notificationMessage=function(c){this._notificationMessage=c};a.get_extendButtonText=function(){return this._extendButtonText||DigitalBeacon.SiteBase.SessionAuditor.DefaultExtendButtonText};a.set_extendButtonText=function(c){this._extendButtonText=c};a.start=function(){this.stop();this._intervalTimerId=setInterval((Blade.del(this,function(){this.checkSession()})),this.get_pollingInterval()*1000)};a.stop=function(){if(this._intervalTimerId>0){clearInterval(this._intervalTimerId);this._intervalTimerId=0}if(this._notificationTimerId>0){clearTimeout(this._notificationTimerId);this._notificationTimerId=0}if(this._signOutTimerId>0){clearTimeout(this._signOutTimerId);this._signOutTimerId=0}};a.checkSession=function(){$.post(this.get_authSessionUrl(),null,Blade.del(this,function(c,d,e){this.checkSessionOnSuccess(c)}))};a.checkSessionOnSuccess=function(c){var d=c;$.digitalbeacon.log(d+" seconds remaining...");if(this._displayNotification&&this._notificationTimerId<=0&&d<this.get_notificationTime()+this.get_pollingInterval()){this._notificationTimerId=setTimeout((Blade.del(this,function(){this.showNotification()})),(d-this.get_notificationTime())*1000);this._signOutTimerId=setTimeout((Blade.del(this,function(){this.signOut()})),d*1000);clearInterval(this._intervalTimerId);this._intervalTimerId=0}};a.showNotification=function(){$.post(this.get_authSessionUrl(),null,Blade.del(this,function(c,e,f){var d=c;if(d<this.get_notificationTime()+this.get_pollingInterval()){$.sb.displayMessage(this.get_notificationMessage().formatWith(this.get_notificationTime(),this.get_notificationTime()/60),this.get_notificationHeading(),"",this.get_extendButtonText(),Blade.del(this,function(){this.extendSession()}))}else{this.start()}}))};a.signOut=function(){$.post(this.get_authSessionUrl(),null,Blade.del(this,function(c,e,f){var d=c;if(d<this.get_pollingInterval()){location.href=this.get_signOutUrl()}else{this.start()}}))};a.extendSession=function(){$.post(this.get_extendSessionUrl());this.start()};return b})();DigitalBeacon.SiteBase.SessionAuditor.DefaultPollingInterval=300;DigitalBeacon.SiteBase.SessionAuditor.DefaultNotificationTime=60;DigitalBeacon.SiteBase.SessionAuditor.DefaultAuthSessionUrl="~/.authSession.ashx";DigitalBeacon.SiteBase.SessionAuditor.DefaultExtendSessionUrl="~/account/extendSession";DigitalBeacon.SiteBase.SessionAuditor.DefaultSignOutUrl="~/identity/signOut";DigitalBeacon.SiteBase.SessionAuditor.DefaultNotificationHeading="Session Expiration";DigitalBeacon.SiteBase.SessionAuditor.DefaultNotificationMessage="Your session is set to expire in one minute.";DigitalBeacon.SiteBase.SessionAuditor.DefaultExtendButtonText="Extend Session";DigitalBeacon.SiteBase.SessionAuditor._instance=null;DigitalBeacon.SiteBase.SessionAuditor.instance=function(){if(DigitalBeacon.SiteBase.SessionAuditor._instance===null){DigitalBeacon.SiteBase.SessionAuditor._instance=new DigitalBeacon.SiteBase.SessionAuditor()}return DigitalBeacon.SiteBase.SessionAuditor._instance};$.digitalbeacon.registerJQueryPlugin("sbEditor",(function(b,c){var a=$(b).data("sbEditor");if(!a){new DigitalBeacon.SiteBase.Editor(b,c)}return a}));