(function(a){if(a.fn.modalBox){a.digitalbeacon.modalBox=function(i){if(typeof i==="string"){i={content:i}}if(!i.width&&!i.nonPersistentWidth){i.width=a.digitalbeacon.modalBox.defaults.width}if(i.replace==undefined){i.replace=true}if(i.reposition==undefined){i.reposition=true}if(i.ajax||i.ajaxPost){a.ajax({url:i.ajaxPost?i.ajaxPost:i.ajax,type:i.ajaxPost?"POST":"GET",data:i.data,success:function(n){i.ajax=null;i.ajaxPost=null;i.content=n;a.digitalbeacon.modalBox(i)}})}else{var g=a.digitalbeacon.getModalBox();if(g.length){if(g.hasClass("loading")){a.digitalbeacon._executeCloseHandler(g,true)}var j=false;if(i.replace){j=!(a.digitalbeacon._executeCloseHandler(g,false))}var h=g.find(".modalBoxBodyContent");var l=h.find("> ul#modalBoxStack");var c=h.find("> :not(ul#modalBoxStack)");var m=h;var e;if(j){m=l.find("> li:last").data("modalBoxOptions",i)}else{if(i.replace||c.length==0){g.data("modalBoxOptions",i)}else{e=c;if(l.length){e=e.add(l.find("> li"))}else{l=a("<ul/>").attr("id","modalBoxStack").appendTo(h)}m=a("<li/>").attr("id","modalBoxStackItem").data("modalBoxOptions",i).appendTo(l)}}var d=a.digitalbeacon.modalBox.defaults.noDataText;if(i.content){d=i.content}else{if(i.element){d=a(i.element).html()}}a.digitalbeacon._updateModalBoxContent(g,m,e,d,i)}else{var k={killModalboxWithCloseButtonOnly:true,minimalTopSpacingOfModalbox:25};if(i.content){a.extend(k,{directCall:{data:i.content}})}else{if(i.element){a.extend(k,{directCall:{element:i.element}})}else{a.extend(k,{directCall:{data:a.digitalbeacon.modalBox.defaults.noDataText}})}}if(i.width&&typeof i.width=="number"){a.extend(k,{setWidthOfModalLayer:i.width})}else{if(i.nonPersistentWidth&&typeof i.nonPersistentWidth=="number"){a.extend(k,{setWidthOfModalLayer:i.nonPersistentWidth})}}if(i.clickOutsideToClose){a.extend(k,{killModalboxWithCloseButtonOnly:!i.clickOutsideToClose})}if(i.success){a.extend(k,{callFunctionAfterSuccess:i.success})}a.fn.modalBox(k);g=a("#modalBox");g.addClass("visible");if(i.width&&typeof i.width=="string"&&i.width!="auto"){g.css("width",i.width);a.digitalbeacon.centerModalBox(g)}else{if(i.nonPersistentWidth&&typeof i.nonPersistentWidth=="string"&&i.width!="auto"){g.css("width",i.nonPersistentWidth);a.digitalbeacon.centerModalBox(g)}}g.data("modalBoxOptions",i);var f=a("#modalBoxFaderLayer");f.fadeTo(0,0.01);f.addClass("visible");f.fadeTo(300,0.4);a("body").addClass("modalBoxOpen")}}};a.digitalbeacon.modalBox.defaults={loadingText:"Loading...",noDataText:"<p>No content available</p>",width:"auto",loadingWidth:"auto"};a.digitalbeacon.closeModalBox=function(){a.fn.modalBox.close()};a.digitalbeacon.showLoadingModalBox=function(c){if(c>0){a.digitalbeacon.modalBoxLoadingTimerId=setTimeout(function(){a.digitalbeacon.modalBoxLoading(0)},c)}else{a.digitalbeacon.modalBox({content:'<div id="modalBoxAjaxLoader">'+a.digitalbeacon.modalBox.defaults.loadingText+"</div>",nonPersistentWidth:a.digitalbeacon.modalBox.defaults.loadingWidth,replace:false,reposition:true});a.digitalbeacon.getModalBox().addClass("loading")}};a.digitalbeacon.hideLoadingModalBox=function(c){if(!c){c=a.digitalbeacon.getModalBox()}if(c.length){if(c.hasClass("loading")){a.digitalbeacon.closeModalBox();c.removeClass("loading")}}if(a.digitalbeacon.modalBoxLoadingTimerId){window.clearTimeout(a.digitalbeacon.modalBoxLoadingTimerId);a.digitalbeacon.modalBoxLoadingTimerId=null}};a.digitalbeacon.getModalBox=function(){return a("body > #modalBox:visible")};a.digitalbeacon.isModalBoxVisible=function(){return a.digitalbeacon.getModalBox().length};a.digitalbeacon.centerModalBox=function(c){if(!c){c=a.digitalbeacon.getModalBox()}if(c.length){a(window).resize()}};a.digitalbeacon.modalBoxOnClose=function(c){setTimeout(function(){var e=a.digitalbeacon.getModalBox();if(e.length){var h=e.find(".modalBoxBodyContent > ul#modalBoxStack");var d=e;if(h.length){d=h.find("> li:last")}var f=d.data("modalBoxOptions");if(!f.close){f.close=c}else{var g=f.close;f.close=function(){c();g()}}}},0)};a.digitalbeacon._updateModalBoxContent=function(g,e,d,c,h){var f=g.hasClass("loading");var i=h.reposition||f;if(i){g.removeClass("visible");if(h.width){g.css("width",h.width)}else{if(h.nonPersistentWidth){g.css("width",h.nonPersistentWidth)}}}e.html(c);if(d){d.hide()}if(h.success){h.success()}if(i){a(window).resize();g.addClass("visible")}if(f){g.removeClass("loading")}};a.digitalbeacon._executeCloseHandler=function(f,j,i){if(!f){f=a.digitalbeacon.getModalBox()}if(f.length){var g=f.find(".modalBoxBodyContent");var d=g.find("> :not(ul#modalBoxStack)");var k=g.find("> ul#modalBoxStack");var h;if(k.length){var e=k.find("> li:last");h=e.data("modalBoxOptions");if(h.close){try{h.close()}catch(c){}}if(j){e.remove();if(k.find("> li").length){e=k.find("> li:last");h=e.data("modalBoxOptions");if(h.width){f.css("width",h.width)}e.show()}else{k.remove();h=f.data("modalBoxOptions");if(h.width){f.css("width",h.width)}d.show()}if(i){f.removeClass("visible");a.digitalbeacon.centerModalBox(f);f.addClass("visible")}}else{e.data("modalBoxOptions",null)}return false}else{h=f.data("modalBoxOptions");if(h&&h.close){try{h.close()}catch(c){}}if(j){d.remove()}else{f.data("modalBoxOptions",null)}return true}return false}};var b=a.fn.modalBox.close;a.fn.modalBox.close=function(e){var d=a.digitalbeacon.getModalBox();if(a.digitalbeacon._executeCloseHandler(d,true,true)){var c=a("#modalBoxFaderLayer");d.fadeTo(0,0.01);c.fadeTo(300,0.01,function(){b(e)});a("body").removeClass("modalBoxOpen")}}}})(jQuery);