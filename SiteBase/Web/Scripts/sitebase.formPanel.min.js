(function(a){a.sb.formPanel=function(e,g){this.element=e;this.deleteConfirmText=a.sb.localization.confirmText;a.extend(this,g);var f=this;this.form=a("form",this.element)[0];if(this.listPanelId){var b=a(this.listPanelId);if(b.length==1){this.listPanelElement=b[0]}}if(a.sb.itemSequencers&&this.itemSequencerKey){this.itemSequencer=a.sb.itemSequencers[this.itemSequencerKey]}if(this.ajax){a.sb.addTooltips();if(this.deleteUrl){a(this.deleteId,this.element).click(function(){f.deleteItem();return false})}if(this.formTarget){a("#"+this.formTarget,this.element).load(function(){var h=a(this).contents().find("textarea");if(h.length==1){f.updateContent(h.text(),"submit")}})}a(this.cancelId,this.element).click(function(){f.cancel();return false});if(this.itemSequencer&&this.itemSequencer.currentIndex>=0){var d=a(this.previousId,this.element).show();var c=a(this.nextId,this.element).show();if(!this.itemSequencer.isFirst()){if(f.previousTooltip){d.attr("title",f.previousTooltip)}d.click(function(){f.previous();return false})}else{d.removeClass("link").addClass("disabled")}if(!this.itemSequencer.isLast()){if(f.nextTooltip){c.attr("title",f.nextTooltip)}c.click(function(){f.next();return false})}else{c.removeClass("link").addClass("disabled")}}}this.validationOptions={formId:this.form.id,submitHandler:function(h){f.submitForm(h)}};if(this.initValidation){a.sb.initClientFormValidation(this.validationOptions)}};a.sb.formPanel.prototype={prepareForm:function(b){},updateContent:function(c,b){if(this.listPanelElement&&b!="cancel"&&b!="previous"&&b!="next"){a(this.listPanelElement).trigger("refresh")}a.sb.modalBox({content:c,width:this.modalBoxWidth,reposition:(b!="previous"&&b!="next")})},cancel:function(){if(a.sb.isModalBoxVisible()){a.sb.closeModalBox()}else{var b=this;a.post(b.form.action,{cancel:"cancel"},function(c){b.updateContent(c,"cancel")})}},submitForm:function(b){var c=this;if(a.sb.checkFormSubmission(b)){c.prepareForm(b);if(c.formTarget){b.action=a.sb.getRenderPartialWrappedUrl(b.action);b.target=c.formTarget;b.submit()}else{if(c.ajaxGet){a.get(b.action,a(b).serialize(),function(d){c.updateContent(d,"submit")})}else{if(c.ajax){a.post(b.action,a(b).serialize(),function(d){c.updateContent(d,"submit")})}else{b.submit()}}}}return false},action:function(e,c,b){var d=this;if(a.sb.checkFormSubmission(this.form)){a.post(e,c,function(f){d.updateContent(f,b)})}},deleteItem:function(){if(confirm(this.deleteConfirmText)){var b=this;a.ajax({url:this.deleteUrl,type:"DELETE",success:function(c){b.updateContent(c,"delete")}})}},previous:function(){var b=this;this.itemSequencer.getPrevious(function(c){a.post(c,null,function(d){b.updateContent(d,"previous")})})},next:function(){var b=this;this.itemSequencer.getNext(function(c){a.post(c,null,function(d){b.updateContent(d,"previous")})})},resetSubmitFlag:function(){a.sb.resetFormSubmission(this.form)}};a.fn.sbFormPanel=function(b){b=a.extend({},a.fn.sbFormPanel.defaults,b);return this.each(function(){if(!a(this).data("sbFormPanel")){var c=new a.sb.formPanel(this,b);a(this).data("sbFormPanel",c)}})};a.fn.sbFormPanel.defaults={cancelId:"#cancel",deleteId:"#delete",previousId:"#previous",nextId:"#next",deleteUrl:null,ajax:false,ajaxGet:false,initValidation:true,itemSequencerKey:null,formTarget:null,modalBoxWidth:null}})(jQuery);